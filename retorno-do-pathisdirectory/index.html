<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  
  
      
  
      
  

  <head>
  <meta charset="utf-8" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - Retorno do PathIsDirectory</title>
  <meta name="author" content="" />

  <meta name="generator" content="Hugo 0.67.1" />

  
  <meta property="og:title" content="Retorno do PathIsDirectory"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/retorno-do-pathisdirectory/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Estava eu outro dia programando aquele código esperto &quot;para ontem&quot; quando me deparei com uma situação no mínimo inusitada. Ao testar se um caminho recebido era de fato um diretório me foi..."/>

  
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>

  
  
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>

  
  <script>
  
    
      <!-- Google Analytics -->
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50557403-2', 'auto');
      ga('send', 'pageview');
    
  
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/list.js"></script>

  
  <link rel="icon" href="/img/favicon.ico"/>
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">

  <div class="container">

    <div class="navbar-brand">
        <img alt="Brand" src="/img/brand.svg">
        &nbsp;
        <a class="navbar-item" title="Go to Home" href="/">
            <div class="is-6">Blogue do Caloni</div>
        </a>
    </div>

    

  </div>
</nav>


      
      <div class="container">
        <p class="title">

Retorno do PathIsDirectory

</p>

        <p class="subtitle">

  Wanderley Caloni,
  
    
  
    
  
  2008-09-10<a href="https://github.com/Caloni/blog/blob/master/content/posts/retorno-do-pathisdirectory.md">.</a>

</p>

        

        
          <div class="content">

            
              <p>Estava eu outro dia programando aquele código esperto &quot;para ontem&quot; quando me deparei com uma situação no mínimo inusitada. Ao testar se <a href="http://msdn.microsoft.com/en-us/library/bb773621(VS.85).aspx">um caminho recebido era de fato um diretório</a> me foi retornado pela API um valor diferente de TRUE. E diferente de FALSE!</p>
<p>De acordo com a documentação, o retorno deveria ser TRUE caso o caminho enviado à função fosse de fato um diretório. Caso contrário, o retorno deveria ser FALSE.</p>
<p>Note que existem apenas dois valores possíveis para essa função. Porém, o valor retornado não é 1, o equivalente ao define TRUE, mas sim 0x10 (16 em hexadecimal). O simples exemplo abaixo deve conseguir reproduzir a situação (Windows XP Service Pack 3):</p>
<pre><code>Setting environment for using Microsoft Visual Studio 2008 x86 tools.

C:\Tests&gt;copy con IsPathDir.cpp
#include &lt;shlwapi.h&gt;
#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;

#pragma comment(lib, &quot;shlwapi.lib&quot;)

int main()
{
        BOOL isDir = PathIsDirectory(&quot;C:\\Tests&quot;); // obs.: diretorio TEM que existir
        printf(&quot;Resultado: %d.\n&quot;, isDir);
}^Z
        1 arquivo(s) copiado(s).

C:\Tests&gt;cl IsPathDir.cpp
Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 for 80x86
Copyright (C) Microsoft Corporation.  All rights reserved.

IsPathDir.cpp
Microsoft (R) Incremental Linker Version 9.00.21022.08
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:IsPathDir.exe
IsPathDir.obj

C:\Tests&gt;IsPathDir.exe
&lt;font color=&quot;#ff0000&quot;&gt;Resultado: 16.&lt;/font&gt;
</code></pre>
<p>Isso quer dizer apenas que o código abaixo vai funcionar,</p>
<pre><code>if( PathIsDirectory(path) ) // legal: qualquer coisa diferente de zero
</code></pre>
<p>o código abaixo vai funcionar</p>
<pre><code>if( ! PathIsDirectory(path) ) // legal: se der zero (FALSE), OK
</code></pre>
<p>e o código abaixo <strong>não vai funcionar</strong>:</p>
<pre><code>if( PathIsDirectory(path) == TRUE ) // vixi: TRUE nem sempre é o resultado
</code></pre>
<p>E, pior, o código abaixo <strong>também não vai funcionar</strong>!</p>
<pre><code>if( PathIsDirectory(path) != TRUE ) // aff... é bom rever os seus conceitos
</code></pre>
<p>Pesquisando um pouco descobri <a href="http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.win32.programmer.kernel&amp;tid=15f6c3fd-a57e-4c27-91ea-2ddd49aaf2a6&amp;cat=&amp;lang=&amp;cr=&amp;sloc=&amp;p=1">uma boa discussão sobre o tema</a>, e inclusive que outras pessoas descobriram o <a href="http://svn.haxx.se/tsvn/archive-2004-10/0425.shtml">interessante detalhe</a> que para pastas normais o retorno é 0x10, mas para compartilhamentos o retorno é 0x1.</p>
<h4 id="o-bug-atrás-dos-documentos">O bug atrás dos documentos</h4>
<p>O problema ocorre por causa da maneira que a função determina se o caminho é um diretório ou não. Uma simples vistoria sobre a função nos revela o detalhe crucial:</p>
<pre><code>C:\Tests&gt;cl /Zi IsPathDir.cpp
Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 for 80x86
Copyright (C) Microsoft Corporation.  All rights reserved.

IsPathDir.cpp
Microsoft (R) Incremental Linker Version 9.00.21022.08
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:IsPathDir.exe
/debug
IsPathDir.obj

C:\Tests&gt;cdb IsPathDir.exe

Microsoft (R) Windows Debugger Version 6.8.0004.0 X86
Copyright (c) Microsoft Corporation. All rights reserved.

CommandLine: IsPathDir.exe
Symbol search path is: SRV*c:\symbols*http://msdl.microsoft.com/download/symbols
Executable search path is:
ModLoad: 00400000 00426000   IsPathDir.exe
ModLoad: 7c900000 7c9b4000   ntdll.dll
ModLoad: 7c800000 7c8ff000   C:\WINDOWS\system32\kernel32.dll
ModLoad: 77ea0000 77f16000   C:\WINDOWS\system32\SHLWAPI.dll
ModLoad: 77f50000 77ffb000   C:\WINDOWS\system32\ADVAPI32.dll
ModLoad: 77db0000 77e41000   C:\WINDOWS\system32\RPCRT4.dll
ModLoad: 77e50000 77e97000   C:\WINDOWS\system32\GDI32.dll
ModLoad: 7e360000 7e3f0000   C:\WINDOWS\system32\USER32.dll
ModLoad: 77bf0000 77c48000   C:\WINDOWS\system32\msvcrt.dll
(ea0.de0): Break instruction exception - code 80000003 (first chance)
eax=00241eb4 ebx=7ffde000 ecx=00000004 edx=00000010 esi=00241f48 edi=00241eb4
eip=7c901230 esp=0012fb20 ebp=0012fc94 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
ntdll!DbgBreakPoint:
7c901230 cc              int     3
0:000&gt; &lt;font color=&quot;#ff0000&quot;&gt;g shlwapi!PathIsDirectoryA&lt;/font&gt;
ModLoad: 76360000 7637d000   C:\WINDOWS\system32\IMM32.DLL
ModLoad: 62e80000 62e89000   C:\WINDOWS\system32\LPK.DLL
ModLoad: 74d50000 74dbb000   C:\WINDOWS\system32\USP10.dll
eax=009836e0 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
eip=77ee7538 esp=0012ff6c ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA:
77ee7538 8bff            mov     edi,edi
0:000&gt; p
eax=009836e0 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
eip=77ee753a esp=0012ff6c ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x2:
77ee753a 55              push    ebp
0:000&gt;
eax=009836e0 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
eip=77ee753b esp=0012ff68 ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x3:
77ee753b 8bec            mov     ebp,esp
0:000&gt;
eax=009836e0 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
eip=77ee753d esp=0012ff68 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x5:
77ee753d 81ec0c020000    sub     esp,20Ch
0:000&gt;
eax=009836e0 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
eip=77ee7543 esp=0012fd5c ebp=0012ff68 iopl=0         nv up ei pl nz ac pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000216
SHLWAPI!PathIsDirectoryA+0xb:
77ee7543 a180d2f077      mov     eax,dword ptr [SHLWAPI!__security_cookie
0:000&gt;
eax=00007a43 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
eip=77ee7548 esp=0012fd5c ebp=0012ff68 iopl=0         nv up ei pl nz ac pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000216
SHLWAPI!PathIsDirectoryA+0x10:
77ee7548 56              push    esi
0:000&gt;
eax=00007a43 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0006f4cc edi=7c911970
eip=77ee7549 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz ac pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000216
SHLWAPI!PathIsDirectoryA+0x11:
*** WARNING: Unable to verify checksum for IsPathDir.exe
77ee7549 8b7508          mov     esi,dword ptr [ebp+8] ss:0023:0012ff70=0041dc5c
0:000&gt;
eax=00007a43 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee754c esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz ac pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000216
SHLWAPI!PathIsDirectoryA+0x14:
77ee754c 85f6            test    esi,esi
0:000&gt;
eax=00007a43 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee754e esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
SHLWAPI!PathIsDirectoryA+0x16:
77ee754e 8945fc          mov     dword ptr [ebp-4],eax ss:0023:0012ff64=fffffffe
0:000&gt;
eax=00007a43 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee7551 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
SHLWAPI!PathIsDirectoryA+0x19:
77ee7551 0f8493000000    je      SHLWAPI!PathIsDirectoryA+0xb2 (77ee75ea) [br=0]
0:000&gt;
eax=00007a43 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee7557 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
SHLWAPI!PathIsDirectoryA+0x1f:
77ee7557 56              push    esi
0:000&gt;
eax=00007a43 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee7558 esp=0012fd54 ebp=0012ff68 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
SHLWAPI!PathIsDirectoryA+0x20:
77ee7558 e85cc0fdff      call    SHLWAPI!PathIsUNCServerA (77ec35b9)
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee755d esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x25:
77ee755d 85c0            test    eax,eax
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee755f esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x27:
77ee755f 0f8585000000    jne     SHLWAPI!PathIsDirectoryA+0xb2 (77ee75ea) [br=0]
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee7565 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x2d:
77ee7565 56              push    esi
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee7566 esp=0012fd54 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x2e:
77ee7566 e812feffff      call    SHLWAPI!PathIsUNCServerShareA (77ee737d)
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee756b esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x33:
77ee756b 85c0            test    eax,eax
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee756d esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0x35:
77ee756d 0f8486000000    je      SHLWAPI!PathIsDirectoryA+0xc1 (77ee75f9) [br=1]
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee75f9 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0xc1:
77ee75f9 56              push    esi
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee75f9 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0xc1:
77ee75f9 56              push    esi
0:000&gt;
eax=00000000 ebx=7ffde000 ecx=00000001 edx=00422828 esi=0041dc5c edi=7c911970
eip=77ee75fa esp=0012fd54 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0xc2:
77ee75fa ff15d411ea77    &lt;font color=&quot;#ff0000&quot;&gt;call    dword ptr [SHLWAPI!_imp__GetFileAttributesA (77ea11d4)]&lt;/font&gt;
0:000&gt;
eax=00000011 ebx=7ffde000 ecx=7c91056d edx=00140608 esi=0041dc5c edi=7c911970
eip=77ee7600 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0xc8:
77ee7600 83f8ff          cmp     eax,0FFFFFFFFh
0:000&gt;
eax=00000011 ebx=7ffde000 ecx=7c91056d edx=00140608 esi=0041dc5c edi=7c911970
eip=77ee7603 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz ac pe cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000217
SHLWAPI!PathIsDirectoryA+0xcb:
77ee7603 74e5            je      SHLWAPI!PathIsDirectoryA+0xb2 (77ee75ea) [br=0]
0:000&gt;
eax=00000011 ebx=7ffde000 ecx=7c91056d edx=00140608 esi=0041dc5c edi=7c911970
eip=77ee7605 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz ac pe cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000217
SHLWAPI!PathIsDirectoryA+0xcd:
77ee7605 83e010          &lt;font color=&quot;#ff0000&quot;&gt;and     eax,10h&lt;/font&gt;
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=7c91056d edx=00140608 esi=0041dc5c edi=7c911970
eip=77ee7608 esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
SHLWAPI!PathIsDirectoryA+0xd0:
77ee7608 ebe2            jmp     SHLWAPI!PathIsDirectoryA+0xb4 (77ee75ec)
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=7c91056d edx=00140608 esi=0041dc5c edi=7c911970
eip=77ee75ec esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
SHLWAPI!PathIsDirectoryA+0xb4:
77ee75ec 8b4dfc          mov     ecx,dword ptr [ebp-4] ss:0023:0012ff64=00007a43
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0041dc5c edi=7c911970
eip=77ee75ef esp=0012fd58 ebp=0012ff68 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
SHLWAPI!PathIsDirectoryA+0xb7:
77ee75ef 5e              pop     esi
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=77ee75f0 esp=0012fd5c ebp=0012ff68 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
SHLWAPI!PathIsDirectoryA+0xb8:
77ee75f0 e82bcafbff      call    SHLWAPI!__security_check_cookie (77ea4020)
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=77ee75f5 esp=0012fd5c ebp=0012ff68 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0xbd:
77ee75f5 c9              leave
0:000&gt;
&lt;font color=&quot;#ff0000&quot;&gt;eax=00000010&lt;/font&gt; ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=77ee75f6 esp=0012ff6c ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
SHLWAPI!PathIsDirectoryA+0xbe:
77ee75f6 c20400          ret     4
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=0040101f esp=0012ff74 ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
IsPathDir!main+0xf:
0040101f 8945fc          mov     dword ptr [ebp-4],eax ss:0023:0012ff74=00000001
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=00401022 esp=0012ff74 ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
IsPathDir!main+0x12:
00401022 8b45fc          mov     eax,dword ptr [ebp-4] ss:0023:0012ff74=00000010
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=00401025 esp=0012ff74 ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
IsPathDir!main+0x15:
00401025 50              push    eax
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=00401026 esp=0012ff70 ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
IsPathDir!main+0x16:
00401026 6868dc4100      push    offset IsPathDir!__xt_z+0x12c (0041dc68)
0:000&gt;
eax=00000010 ebx=7ffde000 ecx=00007a43 edx=00140608 esi=0006f4cc edi=7c911970
eip=0040102b esp=0012ff6c ebp=0012ff78 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
IsPathDir!main+0x1b:
0040102b e81a000000      call    IsPathDir!printf (0040104a)
0:000&gt;
&lt;font color=&quot;#ff0000&quot;&gt;Resultado: 16.&lt;/font&gt;
eax=0000000f ebx=7ffde000 ecx=004010e5 edx=004228b8 esi=0006f4cc edi=7c911970
eip=00401030 esp=0012ff6c ebp=0012ff78 iopl=0         nv up ei ng nz ac pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000296
IsPathDir!main+0x20:
00401030 83c408          add     esp,8
0:000&gt;
</code></pre>
<p>Ou seja, para pastas locais a função simplesmente usa a conhecidíssima <a href="http://msdn.microsoft.com/en-us/library/aa364944(VS.85).aspx">GetFileAttributes</a>, que retorna o flag 0x10 setado caso se trate de uma pasta, de acordo com a documentação:</p>
<p>&quot;The attributes can be one or more of the following values.</p>
<pre><code>Return code/value              Description


FILE_ATTRIBUTE_ARCHIVE         A file or directory that is an archive file or directory.
32
0x20


FILE_ATTRIBUTE_COMPRESSED      A file or directory that is compressed.
2048
0x800
...

&lt;font color=&quot;#ff0000&quot;&gt;FILE_ATTRIBUTE_DIRECTORY       The handle that identifies a directory.
16
0x10&quot;&lt;/font&gt;
</code></pre>
<p>Aqui termina nossa dúvida sobre o pequenino bug na documentação. E isso nos lembra também que é sempre bom comparar as coisas da melhor maneira possível. E essa melhor maneira em se tratando de ifs é supor apenas dois valores binário: ou é zero ou é não-zero.</p>

            

          </div>

        <div class="taglist">
            
    
      <a href="/tags/draft">draft</a>  <a href="/tags/blog">blog</a> 
    


        </div>

        <div class="navigation-bottom">
            <span class="next-in-section"><a href="http://www.caloni.com.br/todo-programador-e-um-filosofo-em-potencial/">&#x25C1; Todo programador é um filósofo em potencial</a></span>
<span class="prev-in-section"><a href="http://www.caloni.com.br/de-volta-a-tona/">&#x25B7; De volta à tona</a></span>

        </div>

      </div>

    <footer class="footer">
  <div class="container">
    <span style="float: right;"><i style="font-size: small;">Blogue do Caloni 2021<a href="https://github.com/Caloni/blog">.</a> </i></span>
  </div>
</footer>

  </body>

</html>
