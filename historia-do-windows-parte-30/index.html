<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  
  
      
  
      
  

  <head>
  <meta charset="utf-8" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - História do Windows - parte 3.0</title>
  <meta name="author" content="" />

  <meta name="generator" content="Hugo 0.67.1" />

  
  <meta property="og:title" content="História do Windows - parte 3.0"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/historia-do-windows-parte-30/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Windows 3.0
Em 22 de maio de 1990 a versão 3.0 do Windows foi lançada. Foi melhorado o gerenciador de programas e o sistema de ícones, além de um novo gerenciador de arquivos e suporte a 16 cores...."/>

  
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>

  
  
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>

  
  <script>
  
    
      <!-- Google Analytics -->
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50557403-2', 'auto');
      ga('send', 'pageview');
    
  
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/list.js"></script>

  
  <link rel="icon" href="/img/favicon.ico"/>
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">

  <div class="container">

    <div class="navbar-brand">
        <img alt="Brand" src="/img/brand.svg">
        &nbsp;
        <a class="navbar-item" title="Go to Home" href="/">
            <div class="is-6">Blogue do Caloni</div>
        </a>
    </div>

    

  </div>
</nav>


      
      <div class="container">
        <p class="title">

História do Windows - parte 3.0

</p>

        <p class="subtitle">

  Wanderley Caloni,
  
    
  
    
  
  2007-08-03<a href="https://github.com/Caloni/blog/blob/master/content/posts/historia-do-windows-parte-30.md">.</a>

</p>

        

        
          <div class="content">

            
              <p><strong>Windows 3.0</strong></p>
<p>Em 22 de maio de 1990 a versão 3.0 do Windows foi lançada. Foi melhorado o gerenciador de programas e o sistema de ícones, além de um novo gerenciador de arquivos e suporte a 16 cores. Entre as mudanças internas podemos citar a velocidade e a confiabilidade. Como a partir dessa versão apareceram muitos desenvolvedores que passaram a suportar a plataforma, o número de programas disponíveis aumentou, o que conseqüentemente fez com que as vendas alavancassem. Três milhões de cópias foram vendidas apenas no primeiro ano, e assim o Windows se tornou padrão nos computadores domésticos. Quando a versão 3.1 foi lançada, em 6 de abril de 1992, mais três milhões de cópias foram vendidos em apenas dois meses.</p>
<p><a href="http://i.imgur.com/2G8kwD4.0_workspace.png"><img src="http://upload.wikimedia.org/wikipedia/en/1/15/Windows_3.0_workspace.png" alt="Windows 3.0 Desktop"></a></p>
<p><strong>Novas tecnologias</strong></p>
<p>As fontes <a href="http://en.wikipedia.org/wiki/Truetype">TrueType</a> foram adicionadas, junto de novas capacidades multimídia. Outro grande avanço foi na área de comunicação entre aplicativos com a implementação da tecnologia <a href="http://support.microsoft.com/kb/86008">OLE</a> (<em>Object Linking and Embedding</em>), que permitiu documentos de diferentes fabricantes serem intercambiados.</p>
<p>Em novembro de 1993 foi lançada a primeira versão que integrou o Windows e a rede de trabalho, o <strong>Windows for Workgroups 3.1</strong>. O suporte a compartilhamento de arquivos e impressoras apareceu a partir daí. Duas aplicações novas também surgiram: Microsoft Mail, cliente de mail para uso em redes, e Schedule+, uma agenda de trabalho.</p>
<p>E, finalmente, agora já é hora de conversarmos sobre...</p>
<p><strong>Como o sistema de janelas funciona no Windows 3.x</strong></p>
<p><a href="http://www.charlespetzold.com/"><img src="http://i.imgur.com/phBymih.gif" alt="Charles Petzold, em foto do seu site"></a>Quem começou a programar para Windows naquela época com certeza deve ter ouvido falar do livro clássico de <a href="http://www.charlespetzold.com/">Charles Petzold</a>, uma das poucas referências naquela época sem internet: <a href="http://www.amazon.com/Programming-Windows-3-1-Charles-Petzold/dp/1556152647/ref=sr_11_1/105-0066727-6712432?ie=UTF8&amp;qid=1185296183&amp;sr=11-1">Programming Windows 3.1</a>. É um livro consideravelmente completo se considerarmos a época em que foi escrito. Vários exemplos estão disponíveis em suas páginas, mas para os que não viveram essa época (como eu) existe a versão eletrônica disponível para <a href="ftp://ftp.charlespetzold.com/ProgWin30/"><em>download</em></a>. Você deve estar se perguntando se todo esse código-fonte serve para alguma coisa hoje em dia. Por incrível que pareça, serve sim. E para demonstrar o conceito de compatibilidade retroativa da Microsoft, iremos utilizar os mesmos exemplos deste livro, sem por nem tirar uma linha de código. Com o devido <em>copyright</em> e respeito merecidos ao autor, é claro =).</p>
<p>Programar interfaces naquela época não era bem o &quot;clicar e arrastar&quot; de hoje em dia. Eram necessários profundos conhecimentos sobre como o sistema operacional se relacionava com o seu programa e vice-versa. Hoje em dia é possível ainda programar como antigamente, já que toda a estrutura continua a mesma. Porém, é algo extremamente contraprodutivo de se fazer com as IDEs modernas que existem e suas barras de controles pré-fabricados e código automático. Faremos da forma mais rústica para entender como as coisas funcionam por baixo dos panos, o que por si só será extremamente produtivo para o nosso conhecimento.</p>
<p><strong>Classe de janela, janela, função de janela, mensagens e <em>loop</em> de mensagens</strong></p>
<p>Antes de ser criada uma janela, é necessário <strong>registrar uma classe de janela no sistema</strong>, cuja relação com uma janela é mais ou menos a mesma entre classe e objeto no paradigma de orientação a objetos. Você primeiro define uma classe para sua janela e posteriormente pode criar inúmeras janelas a partir da mesma classe.</p>
<pre><code>WNDCLASS wndclass; //Dados sobre a classe de janela.
wndclass.style = CS_HREDRAW | CS_VREDRAW;
wndclass.lpfnWndProc = WndProc; // Função de janela (isso é importante!)
...
wndclass.lpszClassName = szAppName;
RegisterClass (&amp;wndclass) ; // Registra a classe de janela.
</code></pre>
<p>Quando você define uma classe e a registra está dizendo para o sistema qual será sua <strong>função de janela</strong>, i. e., qual será a função responsável por receber as mensagens das janelas criadas.</p>
<pre><code>wndclass.lpfnWndProc = WndProc ; // Função de janela.
...
long FAR PASCAL WndProc (HWND hwnd, WORD message, WORD wParam, LONG lParam)
{
switch( message ) // Manipulando as mensagens.
...
}
</code></pre>
<p>Uma mensagem é um evento que ocorre relativo à sua janela ou o que está acontecendo ao redor dela no mundo Windows. Por exemplo, as janelas recebem eventos a respeito dos cliques do usuário, redesenho da janela, etc. Quem envia essas mensagens é o próprio Windows, e ele espera uma resposta da sua função de janela. Agora a parte esquisita: quem envia essas mensagens para o Windows é o seu próprio aplicativo!</p>
<p><a href="/images/window-proc.gif"><img src="http://i.imgur.com/LwBAko9.gif" alt="Função de janela"></a></p>
<p>O aplicativo fica aguardando por eventos em um <em>loop</em> conhecido como <strong><em>loop</em> de mensagens</strong>. A função do <em>loop</em> basicamente é chamar a função <a href="http://msdn2.microsoft.com/en-us/library/ms644936.aspx">GetMessage</a> e redirecionar as mensagens obtidas para as respectivas funções de janela.</p>
<pre><code>while( GetMessage (&amp;msg, NULL, 0, 0) )
{
   TranslateMessage (&amp;msg);
   DispatchMessage (&amp;msg); // Despacha a mensagem para a função de janela.
}
</code></pre>
<p>E aqui está o código completo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">/*--------------------------------------------------------
</span><span style="color:#75715e">   HELLOWIN.C -- Displays &#34;Hello, Windows&#34; in client area
</span><span style="color:#75715e">                 (c) Charles Petzold, 1990
</span><span style="color:#75715e">  --------------------------------------------------------*/</span>

<span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;windows.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">long</span> FAR PASCAL <span style="color:#a6e22e">WndProc</span> (HWND, WORD, WORD, LONG) ;

<span style="color:#66d9ef">int</span> PASCAL <span style="color:#a6e22e">WinMain</span> (HANDLE hInstance, HANDLE hPrevInstance,
                    LPSTR lpszCmdParam, <span style="color:#66d9ef">int</span> nCmdShow)
     {
     <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> szAppName[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HelloWin&#34;</span> ;
     HWND        hwnd ;
     MSG         msg ;
     WNDCLASS    wndclass ;

     <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>hPrevInstance)
          {
          wndclass.style         <span style="color:#f92672">=</span> CS_HREDRAW <span style="color:#f92672">|</span> CS_VREDRAW ;
          wndclass.lpfnWndProc   <span style="color:#f92672">=</span> WndProc ;
          wndclass.cbClsExtra    <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ;
          wndclass.cbWndExtra    <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ;
          wndclass.hInstance     <span style="color:#f92672">=</span> hInstance ;
          wndclass.hIcon         <span style="color:#f92672">=</span> LoadIcon (NULL, IDI_APPLICATION) ;
          wndclass.hCursor       <span style="color:#f92672">=</span> LoadCursor (NULL, IDC_ARROW) ;
          wndclass.hbrBackground <span style="color:#f92672">=</span> GetStockObject (WHITE_BRUSH) ;
          wndclass.lpszMenuName  <span style="color:#f92672">=</span> NULL ;
          wndclass.lpszClassName <span style="color:#f92672">=</span> szAppName ;

          RegisterClass (<span style="color:#f92672">&amp;</span>wndclass) ;
	  }

     hwnd <span style="color:#f92672">=</span> CreateWindow (szAppName,         <span style="color:#75715e">// window class name
</span><span style="color:#75715e"></span>		    <span style="color:#e6db74">&#34;The Hello Program&#34;</span>,     <span style="color:#75715e">// window caption
</span><span style="color:#75715e"></span>                    WS_OVERLAPPEDWINDOW,     <span style="color:#75715e">// window style
</span><span style="color:#75715e"></span>                    CW_USEDEFAULT,           <span style="color:#75715e">// initial x position
</span><span style="color:#75715e"></span>                    CW_USEDEFAULT,           <span style="color:#75715e">// initial y position
</span><span style="color:#75715e"></span>                    CW_USEDEFAULT,           <span style="color:#75715e">// initial x size
</span><span style="color:#75715e"></span>                    CW_USEDEFAULT,           <span style="color:#75715e">// initial y size
</span><span style="color:#75715e"></span>                    NULL,                    <span style="color:#75715e">// parent window handle
</span><span style="color:#75715e"></span>                    NULL,                    <span style="color:#75715e">// window menu handle
</span><span style="color:#75715e"></span>                    hInstance,               <span style="color:#75715e">// program instance handle
</span><span style="color:#75715e"></span>		    NULL) ;		     <span style="color:#75715e">// creation parameters
</span><span style="color:#75715e"></span>
     ShowWindow (hwnd, nCmdShow) ;
     UpdateWindow (hwnd) ;

     <span style="color:#66d9ef">while</span> (GetMessage (<span style="color:#f92672">&amp;</span>msg, NULL, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))
          {
          TranslateMessage (<span style="color:#f92672">&amp;</span>msg) ;
          DispatchMessage (<span style="color:#f92672">&amp;</span>msg) ;
          }
     <span style="color:#66d9ef">return</span> msg.wParam ;
     }

<span style="color:#66d9ef">long</span> FAR PASCAL <span style="color:#a6e22e">WndProc</span> (HWND hwnd, WORD message, WORD wParam, LONG lParam)
     {
     HDC         hdc ;
     PAINTSTRUCT ps ;
     RECT	 rect ;

     <span style="color:#66d9ef">switch</span> (message)
          {
          <span style="color:#66d9ef">case</span> WM_PAINT:
	       hdc <span style="color:#f92672">=</span> BeginPaint (hwnd, <span style="color:#f92672">&amp;</span>ps) ;

               GetClientRect (hwnd, <span style="color:#f92672">&amp;</span>rect) ;

	       DrawText (hdc, <span style="color:#e6db74">&#34;Hello, Windows!&#34;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>rect,
			 DT_SINGLELINE <span style="color:#f92672">|</span> DT_CENTER <span style="color:#f92672">|</span> DT_VCENTER) ;

	       EndPaint (hwnd, <span style="color:#f92672">&amp;</span>ps) ;
               <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span> ;

          <span style="color:#66d9ef">case</span> WM_DESTROY:
               PostQuitMessage (<span style="color:#ae81ff">0</span>) ;
               <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span> ;
          }

     <span style="color:#66d9ef">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;
     } 

</code></pre></div><p>Esse exemplo é bem velho, mas compila e funciona até hoje, depois de passados 17 anos:</p>
<pre><code>cl /c hellowin.c
link hellowin.obj user32.lib gdi32.li
hellowin.exe
</code></pre>
<p><strong>Travamentos no Windows 16 bits</strong></p>
<p>O Windows 3.x tinha uma particularidade nefasta: qualquer aplicativo poderia travar o sistema como um todo. Se lembrarmos que o Windows antigamente era multitarefa e não-preemptivo, podemos deduzir que enquanto é executada a função de janela de um aplicativo o sistema aguarda por esse aplicativo indefinidamente. Se o aplicativo trava, ele nunca retorna. Se ele nunca retorna, o sistema fica eternamente esperando pelo retorno da função de janela. Alguns travamentos conseguiam ser resolvidos por interrupção, mas a maioria não. <a href="http://www.caloni.com.br/historia-do-windows-parte-40">No próximo capítulo da série</a> veremos como os sistemas de 32 bits resolveram esse pequeno problema.</p>
<p><strong>Problemas para resolver</strong></p>
<p>O que o resto do código do Petzold faz? Dê uma olhada na documentação do <a href="http://msdn.microsoft.com">MSDN</a>. Ela ainda está disponível, já que todos os aplicativos precisam utilizar essas funções, seja diretamente ou através de imensos <a href="http://msdn2.microsoft.com/en-us/netframework/default.aspx"><em>frameworks</em></a> de interface com o usuário. E existem pessoas que precisam suportar código-fonte legado.</p>
<p><strong>Ferramentas para se divertir</strong></p>
<p>Já que agora você sabe o que são funções de janela, mensagens e afins, por que não ver tudo isso funcionando? O Microsoft Visual Studio possui uma ferramenta muito útil para isso chamada <strong>Spy++ (spyxx.exe)</strong>. Existem também <a href="http://www.google.com.br/search?q=spy%2B%2B+site%3Acodeproject.com">aplicativos equivalentes</a> (com fonte). Outra ferramenta muito útil, principalmente na hora de desenvolver janelas com controles comuns do Windows, é o <a href="http://msdn2.microsoft.com/en-us/library/ms649774.aspx">Control Spy</a>.</p>
<h4 id="para-saber-mais">Para saber mais</h4>
<ul>
<li>
<p><a href="http://www.charlespetzold.com/">Sítio de Charles Petzold</a></p>
</li>
<li>
<p><a href="http://www.caloni.com.br/search/historia%20do%20windows%20-%20parte">Outros artigos sobre a história do windows</a></p>
</li>
</ul>

            

          </div>

        <div class="taglist">
            
    
      <a href="/tags/draft">draft</a>  <a href="/tags/blog">blog</a> 
    


        </div>

        <div class="navigation-bottom">
            <span class="next-in-section"><a href="http://www.caloni.com.br/historia-do-windows-parte-351/">&#x25C1; História do Windows - parte 3.51</a></span>
<span class="prev-in-section"><a href="http://www.caloni.com.br/historia-da-linguagem-c-parte-1/">&#x25B7; História da linguagem C - parte 1</a></span>

        </div>

      </div>

    <footer class="footer">
  <div class="container">
    <span style="float: right;"><i style="font-size: small;">Blogue do Caloni 2021<a href="https://github.com/Caloni/blog">.</a> </i></span>
  </div>
</footer>

  </body>

</html>
