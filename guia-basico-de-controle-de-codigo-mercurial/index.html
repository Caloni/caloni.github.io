<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  
  
      
  
      
  

  <head>
  <meta charset="utf-8" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - Guia básico de controle de código (Mercurial)</title>
  <meta name="author" content="" />

  <meta name="generator" content="Hugo 0.67.1" />

  
  <meta property="og:title" content="Guia básico de controle de código (Mercurial)"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/guia-basico-de-controle-de-codigo-mercurial/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Houve um bom motivo para que, semana passada, eu estivesse caçando inúmeras versões de um projeto desenvolvido fora da empresa: falta de controle de código. Esse tipo de lapso pode consumir de horas a..."/>

  
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>

  
  
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>

  
  <script>
  
    
      <!-- Google Analytics -->
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50557403-2', 'auto');
      ga('send', 'pageview');
    
  
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/list.js"></script>

  
  <link rel="icon" href="/img/favicon.ico"/>
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">

  <div class="container">

    <div class="navbar-brand">
        <img alt="Brand" src="/img/brand.svg">
        &nbsp;
        <a class="navbar-item" title="Go to Home" href="/">
            <div class="is-6">Blogue do Caloni</div>
        </a>
    </div>

    

  </div>
</nav>


      
      <div class="container">
        <p class="title">

Guia básico de controle de código (Mercurial)

</p>

        <p class="subtitle">

  Wanderley Caloni,
  
    
  
    
  
  <a href="https://github.com/Caloni/blog/blob/master/content/posts/guia-basico-de-controle-de-codigo-mercurial.md">2008-04-15</a>

</p>

        

        
          <div class="content">

            
              <p>Houve um bom motivo para que, semana passada, eu estivesse caçando inúmeras versões de um projeto desenvolvido fora da empresa: <strong>falta de controle de código</strong>. Esse tipo de lapso pode consumir de horas a dias de tempo perdido, dependendo de em quantas cópias de máquinas virtuais ficou espalhado o código.</p>
<p>Já <a href="http://www.caloni.com.br/guia-basico-de-controle-de-codigo-source-safe">escrevi a respeito</a> da importância de controlar e gerenciar o código-fonte para que a falta de um histórico exato das alterações não seja motivo de recorreções de problemas, binários no cliente sem contraparte para ajustes, além de uma série de dores de cabeça que costumam começar a ocorrer assim que nos damos conta que nosso software está uma bagunça que dói.</p>
<p>Na época, discursei brevemente sobre alguns exemplos de gerenciadores de fonte que utilizam <strong>modelo centralizado</strong>, e nos exemplos práticos usamos o famigerado <strong>Source Safe</strong>, velho amigo de quem já programa ou programou Windows por alguns anos. Além dele, temos os conhecidíssimos <a href="http://www.nongnu.org/cvs/">CVS</a> e <a href="http://subversion.tigris.org/">Subversion</a>, ambos largamente utilizados no mundo todo.</p>
<p>No entanto, uma nova forma de controlar fontes está nascendo já há algum tempo, com relativo sucesso e crescentes esperanças: o <a href="http://en.wikipedia.org/wiki/Distributed_revision_control">modelo distribuído</a>. Nesse tipo de gerenciamento, a liberdade aumenta exponencialmente, permitindo coisas que no modelo antigo seriam muito difíceis de serem implementadas. Não vou me delongar explicando a teoria por trás da idéia, sabendo que, além de existir um ótimo texto explicando as vantagens em cima do modelo centralizado <a href="http://ianclatworthy.files.wordpress.com/2007/10/dvcs-why-and-how3.pdf">disponível na web</a>, o próprio sítio das implementações atuais explica a idéia de maneira muito convincente. E são elas:</p>
<ul>
<li>
<p><a href="http://git.or.cz/">Git</a>. Conhecido como o controlador de fontes do <em>kernel</em> do Linux. Escrita a versão inicial por Linux Torvalds em C e módulos de Perl pendurados, hoje em dia tem como principal desvantagem a falta de suporte nos ambientes Windows, impactando negativamente em projetos portáveis. Sua principal vantagem, no entanto, é a rapidez: é o controle de fonte mais rápido do oeste.</p>
</li>
<li>
<p><a href="http://www.selenic.com/mercurial/wiki/">Mercurial</a> (ou <em><strong>hg</strong></em>). Sem dúvida o mais fácil de usar. Bem documentado e com comandos intuitivos para o usuário, vem ganhando mais adeptos a cada dia. Seu desempenho é comparável ao do Git, e seu sistema de arquivos é bem eficiente.</p>
</li>
<li>
<p><a href="http://bazaar-vcs.org/">Bazaar</a> (ou <em><strong>bzr</strong></em>). O irmão mais próximo do Mercurial, com comandos bem parecidos. Um costuma lembrar os comandos do outro, com pequenas diferenças. Seu desempenho não chega a ser comparável aos dois acima, mas sua robustez compensa, pois é o único, de acordo com testes e estudos, que suporta o controle total de operações de renomeação de arquivos e pastas. Recentemente seu projeto tem evoluído muito.</p>
</li>
</ul>
<h4 id="distribuído-x-centralizado">Distribuído x Centralizado</h4>
<p>Nos sistemas centralizados o repositório de fontes fica em um lugar definido, de onde as pessoas pegam a última versão e sobem modificações, ou não, caso não tenham direito para isso.</p>
<p>Nos sistemas distribuídos, o histórico e ramificações ficam todos <strong>locais</strong>. Como assim locais? Bom, locais do jeito que eu estou falando quer dizer: <strong>na própria pasta onde se está desenvolvendo</strong>.</p>
<p>É lógico que pode existir uma versão de ramificações no servidor, que no caso do controle distribuído é mais um membro da rede <em>peer-to-peer</em> de ramificações, já que cada colaborador possui seu próprio repositório local, capaz de trocar revisões entre colaboradores e subir revisões os servidores que interessarem.</p>
<p>Além disso, o conceito de ramificações (<em>branches</em>) e consolidação de versões (<em>merging</em>) é muito mais presente do que em sistemas como o Subversion, onde o <em>commit</em> (ato de enviar as revisões de um código para o repositório central) ocorre de forma controlada. Da maneira distribuída, é comum criar um <em>branch</em> para cada problema ou <em>feature</em> sendo desenvolvida, e ir juntando tudo isso imediatamente após terminado, gerando um histórico bem mais detalhado e livre de gargalos com modificações temporárias.</p>
<p>Porém, a maior vantagem em termos de desenvolvimento acaba sendo a liberdade dos usuários, que podem trocar modificações de código entre si, sem existir a figura centralizadora do <em>branch</em> oficial. Ela pode existir, mas não é mais uma condição <em>sine qua non</em> para modificações no fonte.</p>
<h4 id="caso-de-uso-mercurial">Caso de uso: Mercurial</h4>
<p>Comecei a usar em meus projetos pessoais o <strong>Mercurial</strong> por ter <a href="http://www.evilbitz.com/2007/11/04/an-approach-to-revision-control-your-documents/">ouvido falar</a> dele primeiro. Achei a idéia fantástica, pois já estava à procura de um substituto para meu velho Source Safe, meio baleado das tantas inovações de controle de fonte que surgiram nos projetos de fonte aberto. Outro motivo para desistir do Source Safe foi o fato de ser uma solução comercial que custa dinheiro e não chega a ser absurdamente mais fácil de usar a ponto de valer a pena usá-lo.</p>
<p>O princípio de uso de uma ferramenta distribuída é muito simples: se você tiver um diretório de projeto já criado, basta, dentro dessa pasta, iniciar o repositório de fontes.</p>
<pre><code>&gt; hg init
</code></pre>
<p>Após isso, será criada uma pasta com o nome .hg. Dentro dela é armazenado todo o histórico dos fontes. Podemos inicialmente adicionar os arquivos do projeto existente e fazer o primeiro <em>commit</em>, que irá começar a controlar os arquivos adicionados dentro dessa pasta e subpastas:</p>
<pre><code>&gt; hg add
adding Header.h
adding Main.cpp
adding Project.cpp
adding Project.vcproj


&gt; hg commit -m &quot;Primeira versao&quot;
</code></pre>
<p>Se o programa não disse nada ao efetuar o <em>commit</em>, é porque está tudo certo. Agora podemos controlar as mudanças de nosso código usando o comando <em>status</em>. Para vermos o histórico usamos o comando <em>log</em>.</p>
<pre><code>&gt; hg log
changeset:   0:e9246bcf2107
tag:         tip
user:        Wanderley Caloni &lt;wanderley@caloni.com.br&gt;
date:        Tue Apr 15 09:05:27 2008 -0300
summary:     Primeira versao


&gt; echo bla bla bla &gt;&gt; Main.cpp

&gt; hg status
M Main.cpp

&gt; hg commit -m &quot;Alterado algumas coisas&quot;

&gt; hg log
changeset:   1:829b081df653
tag:         tip
user:        Wanderley Caloni &lt;wanderley@caloni.com.br&gt;
date:        Tue Apr 15 09:06:29 2008 -0300
summary:     Alterado algumas coisas

changeset:   0:e9246bcf2107
user:        Wanderley Caloni &lt;wanderley@caloni.com.br&gt;
date:        Tue Apr 15 09:05:27 2008 -0300
summary:     Primeira versao
</code></pre>
<p>Como vimos, ao alterar um arquivo controlado este é mostrado pelo comando <em>status</em> como alterado (o M na frente do Main.cpp). Também existem controles para cópia e exclusão de arquivos.</p>
<p>Esse é o básico que se precisa saber para usar o Mercurial. Simples, não? O resto também é simples: fazer <em>branches</em> e juntá-los é uma questão de costume, e está entre as boas práticas de uso. Eu recomendo fortemente a leitura do tutorial &quot;<strong>Entendendo o Mercurial</strong>&quot;, disponível no sítio do projeto, até para entender o que existe por trás da idéia do controle descentralizado de fontes. Existe uma <a href="http://www.selenic.com/mercurial/wiki/index.cgi/BrazilianPortugueseUnderstandingMercurial">tradução muito boa</a> feita pelo meu amigo <a href="http://marcioandreyoliveira.blogspot.com/">Márcio</a>.</p>
<p>Como usuário de Windows, posso dizer que a versão funciona muito bem, e é possível fazer coisas como, por exemplo, usar o <a href="http://winmerge.org/">WinMerge</a> para juntar <em>branches</em> ou comparar versões automaticamente, o que por si só já mata toda a necessidade que eu tinha do Source Safe.</p>
<h4 id="mercurial-ou-bazaar">Mercurial ou Bazaar?</h4>
<p>Testei o Mercurial por cerca de três meses desde que o conheci. Esse fim-de-semana conheci mais a fundo o Bazaar, e pretendo começar a testá-lo também para ter uma visão dos dois mundos e optar por um deles. Ambos são projetos relativamente novos que prometem muito. De uma forma ou de outra, os programadores solitários agora possuem um sistema de controle de fontes sem frescura e que funciona para todos.</p>
<h4 id="para-começar-começando">Para começar começando</h4>
<ul>
<li>
<p><a href="http://www.selenic.com/mercurial/wiki/index.cgi/BrazilianPortugueseTutorial">Leia o tutorial passo-a-passo do Mercurial</a></p>
</li>
<li>
<p><a href="http://doc.bazaar-vcs.org/bzr.dev/en/mini-tutorial/index.html">Leia o tutorial passo-a-passo do Bazaar</a></p>
</li>
<li>
<p>Comece a usá-los em projetos simples e pequenos</p>
</li>
<li>
<p>Comece a comparar seu uso ao do Subversion; identifique prós e contras</p>
</li>
<li>
<p>Trace um roteiro de migração e mão à massa</p>
</li>
</ul>

            

          </div>

        <div class="taglist">
            
    
      <a href="/tags/draft">draft</a>  <a href="/tags/code">code</a> 
    <a class="externalgray" href="https://telegram.me/share/url?url=http://www.caloni.com.br/guia-basico-de-controle-de-codigo-mercurial/">discuss</a>


        </div>

        <div class="navigation-bottom">
            <span class="next-in-section"><a href="http://www.caloni.com.br/crash-dump-analysis-o-livro/">&#x25C1; Crash Dump Analysis: o livro</a></span>
<span class="prev-in-section"><a href="http://www.caloni.com.br/aprendendo-assembly-com-o-depurador/">&#x25B7; Aprendendo assembly com o depurador</a></span>

        </div>

      </div>

    <footer class="footer">
  <div class="container">
    <span style="float: right;"><i style="font-size: small;">Blogue do Caloni <a href="https://github.com/Caloni/blog">2021.04.12</a> </i></span>
  </div>
</footer>

  </body>

</html>
