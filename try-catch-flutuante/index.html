<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  
  
      
  
      
  

  <head>
  <meta charset="utf-8" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - Try-catch flutuante</title>
  <meta name="author" content="" />

  <meta name="generator" content="Hugo 0.67.1" />

  
  <meta property="og:title" content="Try-catch flutuante"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/try-catch-flutuante/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Esse detalhe da linguagem quem me fez descobrir foi o Yorick, que costuma comentar no blogue e tive o prazer de conhecer no 4o. EPA-CCPP.
É possível, apesar de bizarro, colocar um bloco try-catch em..."/>

  
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>

  
  
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>

  
  <script>
  
    
      <!-- Google Analytics -->
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50557403-2', 'auto');
      ga('send', 'pageview');
    
  
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/list.js"></script>

  
  <link rel="icon" href="/img/favicon.ico"/>
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">

  <div class="container">

    <div class="navbar-brand">
        <img alt="Brand" src="/img/brand.svg">
        &nbsp;
        <a class="navbar-item" title="Go to Home" href="/">
            <div class="is-6">Blogue do Caloni</div>
        </a>
    </div>

    

  </div>
</nav>


      
      <div class="container">
        <p class="title">

Try-catch flutuante

</p>

        <p class="subtitle">

  Wanderley Caloni,
  
    
  
    
  
  <a href="https://github.com/Caloni/blog/blob/master/content/posts/try-catch-flutuante.md">2008-04-03</a>

</p>

        

        
          <div class="content">

            
              <p>Esse detalhe da linguagem quem me fez descobrir foi o <strong>Yorick</strong>, que <a href="http://www.caloni.com.br/quando-o-ponteiro-nulo-nao-e-invalido#comment-345">costuma comentar</a> no blogue e tive o prazer de conhecer no <a href="http://www.caloni.com.br/blog/epa-ccpp-4-nossa-comunidade-ganhando-forma">4o. EPA-CCPP</a>.</p>
<p>É possível, apesar de bizarro, colocar um bloco try-catch em torno da lista de inicialização de variáveis de um construtor. Essa característica da linguagem permite que possamos capturar alguma exceção lançada por algum construtor de algum membro da classe. A construção em código ficaria no estilo abaixo:</p>
<pre><code>Class::Class() try : initialization-list
{
    // Class constructor body
}
catch(...) // note: this IS right!
{
    // do something about
    // just like &quot;throw&quot; over here
}
</code></pre>
<p>Apesar dessa capacidade, não conseguimos parar o lançamento da exceção. Após seu lançamento, caímos no bloco catch abaixo do corpo do construtor e a exceção é lançada novamente, como se houvesse uma intrução throw no final do catch.</p>
<p>O exemplo abaixo demonstra um código de uma classe que captura a exceção durante a inicialização dos membros. Na seguida o catch da função main é executada, provando que a exceção de fato não é &quot;salva&quot; no primeiro bloco.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/* This class explodes */</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Explode</span>
{
	<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
		Explode(<span style="color:#66d9ef">int</span> x) 
		{
			m_x <span style="color:#f92672">=</span> x;
			<span style="color:#66d9ef">throw</span> x;
		}

		<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span>()
		{
			std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;The number: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> m_x <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
		}

	<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
		<span style="color:#66d9ef">int</span> m_x;
};

<span style="color:#75715e">/* This class is going to be exploded */</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Victim</span>
{
	<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
		Victim() <span style="color:#66d9ef">try</span> <span style="color:#f92672">:</span> m_explode(<span style="color:#ae81ff">5</span>)
		{
			std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;You&#39;re supposed to NOT seeing this...</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
		}
		<span style="color:#66d9ef">catch</span>(...) 
		{ 
			std<span style="color:#f92672">::</span>cerr <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Something BAD hapenned</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
			std<span style="color:#f92672">::</span>cerr <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;We&#39;re going to blow up</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
			<span style="color:#75715e">// just like &#39;throw&#39; over here
</span><span style="color:#75715e"></span>		}

		<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print</span>()
		{
			m_explode.print();
		}

	<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
		Explode m_explode;
};

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
{
	<span style="color:#66d9ef">try</span>
	{
		Victim vic;
	}
	<span style="color:#66d9ef">catch</span>(...)
	{
		std<span style="color:#f92672">::</span>cerr <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Something BAD BAD happenned...</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
	}
}

 

</code></pre></div><p>Testei esse código nos seguintes compiladores:</p>
<ul>
<li>
<p>Visual Studio 6. Falhou, demonstrando desconhecer a sintaxe.</p>
</li>
<li>
<p>Borland C++ Builder 5. Falhou, demonstrando desconhecer a sintaxe.</p>
</li>
<li>
<p>Borland Developer Studio 4. Falhou, com o mesmo erro.</p>
</li>
<li>
<p>Visual Studio 2003. Comportamento esperado.</p>
</li>
<li>
<p>Visual Studio 2005. Comportamento esperado.</p>
</li>
<li>
<p>Visual Studio 2008. Comportamento esperado.</p>
</li>
<li>
<p>G++ (no Cygwin). Comportamento esperado.</p>
</li>
</ul>
<p>A saída esperada é a seguinte:</p>
<pre><code>Something BAD hapenned
We're going to blow up
Something BAD BAD happenned...
</code></pre>

            

          </div>

        <div class="taglist">
            
    
      <a href="/tags/draft">draft</a>  <a href="/tags/code">code</a> 
    <a class="externalgray" href="https://telegram.me/share/url?url=http://www.caloni.com.br/try-catch-flutuante/">discuss</a>


        </div>

        <div class="navigation-bottom">
            <span class="next-in-section"><a href="http://www.caloni.com.br/conversor-de-houaiss-para-babylon-parte-2/">&#x25C1; Conversor de Houaiss para Babylon - parte 2</a></span>
<span class="prev-in-section"><a href="http://www.caloni.com.br/epa-ccpp-4-nossa-comunidade-ganhando-forma/">&#x25B7; EPA-CCPP 4: nossa comunidade ganhando forma</a></span>

        </div>

      </div>

    <footer class="footer">
  <div class="container">
    <span style="float: right;"><i style="font-size: small;">Blogue do Caloni <a href="https://github.com/Caloni/blog">2021.04.06</a> </i></span>
  </div>
</footer>

  </body>

</html>
