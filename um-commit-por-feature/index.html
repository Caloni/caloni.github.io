<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  
  
      
  
      
  

  <head>
  <meta charset="utf-8" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - Um commit por feature</title>
  <meta name="author" content="" />

  <meta name="generator" content="Hugo 0.67.1" />

  
  <meta property="og:title" content="Um commit por feature"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/um-commit-por-feature/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Imagine que você vai começar a trabalhar em algo novo. Daí você baixa a última versão do branch de dev e começa a codar. Então chega um momento em que o primeiro, segundo, terceiro commits são..."/>

  
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>

  
  
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>

  
  <script>
  
    
      <!-- Google Analytics -->
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50557403-2', 'auto');
      ga('send', 'pageview');
    
  
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/list.js"></script>

  
  <link rel="icon" href="/img/favicon.ico"/>
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">

  <div class="container">

    <div class="navbar-brand">
        <img alt="Brand" src="/img/brand.svg">
        &nbsp;
        <a class="navbar-item" title="Go to Home" href="/">
            <div class="is-6">Blogue do Caloni</div>
        </a>
    </div>

    

  </div>
</nav>


      
      <div class="container">
        <p class="title">

Um commit por feature

</p>

        <p class="subtitle">

  Wanderley Caloni,
  
    
  
    
  
  <a href="https://github.com/Caloni/blog/blob/master/content/posts/um-commit-por-feature.md">2017-02-04</a>

</p>

        

        
          <div class="content">

            
              <p>Imagine que você vai começar a trabalhar em algo novo. Daí você baixa a última versão do branch de dev e começa a codar. Então chega um momento em que o primeiro, segundo, terceiro commits são necessários para manter a ordem em sua cabeça. &quot;Fiz isso logo de manhã, testei algo diferente antes do almoço e de tarde fui incrementando a solução final até passar todos os testes.&quot; Tudo bonito. Mas como fica na hora de subir essa bagaça pras pessoas verem?</p>
<p>Vamos visualizar isso em commits. Você baixa a última versão do dev, começa a trabalhar e de duas uma:</p>
<ol>
<li>Percebe que dá para resolver tudo em um commit só.</li>
<li>Percebe que o buraco é mais embaixo; vou precisar de mais tempo e mais commits.</li>
</ol>
<p>No caso 1, a solução é simples e direta: faça as modificações, rode os testes locais e aplique o commit já no formato definido pela sua equipe (número do ticket, texto no idioma correto, detalhes nos parágrafos abaixo). Suba e mande para code review.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Temp\projectX<span style="color:#75715e">&gt;git pull</span>
Already up-to-date.

C:\Temp\projectX<span style="color:#75715e">&gt;git branch</span>
* dev
  master

C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;ISS-4 Changing test function return type to int.&#34;</span>
[dev 7f0121b] ISS-4 Changing test function return type to int.
 1 file changed, 2 insertions(+), 1 deletion(-)

C:\Temp\projectX<span style="color:#75715e">&gt;git status</span>
On branch dev
Your branch is ahead of &#39;origin/dev&#39; by 1 commit.
  (use <span style="color:#e6db74">&#34;git push&#34;</span> to publish your local commits)
nothing to commit, working tree clean

C:\Temp\projectX<span style="color:#75715e">&gt;</span>
</code></pre></div><p>Se a política de pull request estiver sendo usada, faça isso em um branch à parte, mas já mande para o reviewer aprovar o branch como se fosse um commit apenas e de preferência pronto para o rebase (o que não deve ser nem um problema se for uma mudança pontual).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git co -b ISS-5-changing-test-return-value</span>
M       main.cpp
Switched to a new branch &#39;ISS-5-changing-test-return-value&#39;

C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;ISS-5 Changing test return value&#34;</span>
[ISS-5-changing-test-return-value 38df69c] ISS-5 Changing test return value
 1 file changed, 1 insertion(+), 1 deletion(-)

C:\Temp\projectX<span style="color:#75715e">&gt;git status</span>
On branch ISS-5-changing-test-return-value
nothing to commit, working tree clean

C:\Temp\projectX<span style="color:#75715e">&gt;git push origin ISS-5-changing-test-return-value</span>
Counting objects: 6, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (6/6), 618 bytes | 0 bytes/s, done.
Total 6 (delta 2), reused 0 (delta 0)
To ..\projectXRemote
 * [new branch]      ISS-5-changing-test-return-value -&gt; ISS-5-changing-test-return-value
</code></pre></div><h3 id="quando-o-buraco-é-mais-embaixo">Quando o buraco é mais embaixo</h3>
<p>Quando mais de um commit é necessário é porque vai rolar a festa. Vários commits com texto e modificações temporárias podem ser feitos, e caso o trabalho vire a noite, é recomendado subir tudo para um branch temporário remoto (de preferência que já seja identificado pela equipe como o branch para determinado issue).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Temp\projectX<span style="color:#75715e">&gt;git branch</span>
  ISS-5-changing-test-return-value
* dev
  master

C:\Temp\projectX<span style="color:#75715e">&gt;git co -b ISS-6-very-hard-hacking</span>
Switched to a new branch &#39;ISS-6-very-hard-hacking&#39;

C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>
C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;Starting to test return 42.&#34;</span>
[ISS-6-very-hard-hacking e09cf24] Starting to test return 42.
 1 file changed, 1 insertion(+), 1 deletion(-)

C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>
C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;Created backup test.</span>
[ISS-6-very-hard-hacking 80a7f71] Created backup test.
 1 file changed, 5 insertions(+)

C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>
C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;Deleted backup function test.&#34;</span>
[ISS-6-very-hard-hacking 9620226] Deleted backup function test.
 1 file changed, 5 deletions(-)

C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>
C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;Screwing around.&#34;</span>
[ISS-6-very-hard-hacking 18d3afa] Screwing around.
 1 file changed, 2 deletions(-)

C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>
C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;Getting old version back.&#34;</span>
[ISS-6-very-hard-hacking f2a63d1] Getting old version back.
 1 file changed, 2 insertions(+)

C:\Temp\projectX<span style="color:#75715e">&gt;gvim main.cpp</span>
C:\Temp\projectX<span style="color:#75715e">&gt;git add main.cpp</span>

C:\Temp\projectX<span style="color:#75715e">&gt;git ci -m &#34;Small fix after unit tests.&#34;</span>
[ISS-6-very-hard-hacking e612339] Small fix after unit tests.
 1 file changed, 1 insertion(+), 1 deletion(-)

C:\Temp\projectX<span style="color:#75715e">&gt;git log --oneline</span>
e612339 Small fix after unit tests.
f2a63d1 Getting old version back.
18d3afa Screwing around.
9620226 Deleted backup function test.
80a7f71 Created backup test.
e09cf24 Starting to test return 42.
7f0121b ISS-4 Changing test function return type to int.
97222ec ISS-3 Testing something new.
49d28aa ISS-2 Insertind comments and whatever.
bff8edf ISS-1 First version.
</code></pre></div><p>Agora nós criamos uma bela duma bagunça, mas em um branch apartado e que ainda não foi enviado para pull requet ou inserido no branch de dev. Agora chega a hora de arrumar a casa. Para isso, como tudo no git, há várias maneiras, mas a mais direta é um rebase interativo (-i), onde você pega os commits e empacota tudo junto.</p>
<p>(Obs.: se sua modificação demorou algum tempo é melhor atualizar o branch de dev para ver se há algo novo e fazer o merge com o branch de feature; o rebase daí não encontrará conflitos.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Temp\projectX<span style="color:#75715e">&gt;git merge dev</span>
Already up-to-date.

C:\Temp\projectX<span style="color:#75715e">&gt;git rebase -i dev</span>
</code></pre></div><p>Nesse momento o git irá abrir o editor com os commits trabalhados. Você deverá escolher quais operações fazer com cada commit. Se o objetivo é empacotar tudo, geralmente é pick no primeiro e squash em todos os outros:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">pick e09cf24 Starting to test return 42.
squash 80a7f71 Created backup test.
squash 9620226 Deleted backup function test.
squash 18d3afa Screwing around.
squash f2a63d1 Getting old version back.
squash e612339 Small fix after unit tests.
</code></pre></div><p>Ao final da operação mais uma vez o git irá exibir o editor. Agora é hora de você escolher o texto bonitinho, formatadinho, do seu único commit que será usado no branch de dev. Em outras palavras, transformar isso:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"># This is a combination of 6 commits.
# The first commit&#39;s message is:

Starting to test return 42.

# This is the commit message #2:

Created backup test.

# This is the commit message #3:

Deleted backup function test.

# This is the commit message #4:

Screwing around.

# This is the commit message #5:

Getting old version back.

# This is the commit message #6:

Small fix after unit tests.
</code></pre></div><p>Nisso:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">ISS-6 A very hard hacking, tested and ready to merge.

This hack involved several operations:
 - Starting to test return 42.
 - Created backup test.
 - Deleted backup function test.
 - Small fix after unit tests.
</code></pre></div><p>Agora na hora de fazer o merge seu histórico estará redondo, sem ramificações e com o resultado final de seu hacking parecendo que foi feito bonito desde o começo (ah, vá):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\Temp\projectX<span style="color:#75715e">&gt;git log</span>
commit b4de47231f090e897053f4e9d19ea66c88d1f1fa
Author: Wanderley Caloni &lt;wanderley.caloni@bitforge.com.br&gt;
<span style="color:#66d9ef">Date</span>:   Sat Feb 4 10:59:18 2017 -0200

    ISS-6 A very hard hacking, tested and ready to merge.

    This hack involved several operations:
     - Starting to test return 42.
     - Created backup test.
     - Deleted backup function test.
     - Small fix after unit tests.

commit 7f0121baac183eb1a832575781cca5d6e6a5489c
Author: Wanderley Caloni &lt;wanderley.caloni@bitforge.com.br&gt;
<span style="color:#66d9ef">Date</span>:   Sat Feb 4 10:51:54 2017 -0200

    ISS-4 Changing test function return type to int.

commit 97222ec4578f9a4bced847266739b18f933178f3
Author: Wanderley Caloni &lt;wanderley.caloni@bitforge.com.br&gt;
<span style="color:#66d9ef">Date</span>:   Sat Feb 4 10:50:29 2017 -0200

    ISS-3 Testing something new.

commit 49d28aa7faa02ff327ae9fac93676abad18ad0f3
Author: Wanderley Caloni &lt;wanderley.caloni@bitforge.com.br&gt;
<span style="color:#66d9ef">Date</span>:   Sat Feb 4 10:49:26 2017 -0200

    ISS-2 Insertind comments and whatever.

commit bff8edf06e4a30480088a9a33c9b0c2ca5b6e0b3
Author: Wanderley Caloni &lt;wanderley.caloni@bitforge.com.br&gt;
<span style="color:#66d9ef">Date</span>:   Sat Feb 4 10:47:11 2017 -0200

    ISS-1 First version.
</code></pre></div><h3 id="o-que-aprendemos-aqui">O que aprendemos aqui</h3>
<p>Esta é uma das inúmeras formas de trabalhar com o git de maneira individual sem atrapalhar seus colegas. Basicamente você pode escolher outras estratégias de commits e branchs locais, mas através do comando rebase -i é possível sempre reorganizar a bagunça em commits comportados, e dar a impressão que esses programadores são enviados divinos que modificam o fonte e acertam de primeira.</p>

            

          </div>

        <div class="taglist">
            
    
      <a href="/tags/draft">draft</a>  <a href="/tags/blog">blog</a> 
    <a class="externalgray" href="https://telegram.me/share/url?url=http://www.caloni.com.br/um-commit-por-feature/">discuss</a>


        </div>

        <div class="navigation-bottom">
            <span class="next-in-section"><a href="http://www.caloni.com.br/a-chegada/">&#x25C1; A Chegada</a></span>
<span class="prev-in-section"><a href="http://www.caloni.com.br/um-homem-chamado-ove/">&#x25B7; Um Homem Chamado Ove</a></span>

        </div>

      </div>

    <footer class="footer">
  <div class="container">
    <span style="float: right;"><i style="font-size: small;">Blogue do Caloni <a href="https://github.com/Caloni/blog">2021.04.19</a> </i></span>
  </div>
</footer>

  </body>

</html>
