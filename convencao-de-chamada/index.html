<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - Convenção de Chamada</title>
  <meta name="author" content="" />
  <meta name="description"
        content="Pergunta de um leitor:
void func()
{

}

int main()
{
   func(&quot;sbrubles&quot;);
   return 0;
}

Resposta do Autor: Por que C é zoado :P
OK, a verdade é que não existem (existiam?)..."/>

  <meta name="generator" content="Hugo 0.67.1" />

  
  <meta itemprop="name" content="Convenção de Chamada"/>
  <meta itemprop="description"
        content="Pergunta de um leitor:
void func()
{

}

int main()
{
   func(&quot;sbrubles&quot;);
   return 0;
}

Resposta do Autor: Por que C é zoado :P
OK, a verdade é que não existem (existiam?)..."/>
  <meta itemprop="image"
        content=""/>

  
  <meta property="og:title" content="Convenção de Chamada"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/convencao-de-chamada/"/>
  <meta property="og:image"
        content=""/>
  <meta property="og:description"
        content="Pergunta de um leitor:
void func()
{

}

int main()
{
   func(&quot;sbrubles&quot;);
   return 0;
}

Resposta do Autor: Por que C é zoado :P
OK, a verdade é que não existem (existiam?)..."/>
  <meta property="og:site_name" content="Blogue do Caloni"/>
  <meta property="article:published_time"
        content="2015-04-20T00:00:00&#43;00:00"/>
  <meta property="article:section" content="post"/>

  
  
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site"
        content=""/>
  <meta name="twitter:title" content="Convenção de Chamada"/>
  <meta name="twitter:description"
        content="Pergunta de um leitor:
void func()
{

}

int main()
{
   func(&quot;sbrubles&quot;);
   return 0;
}

Resposta do Autor: Por que C é zoado :P
OK, a verdade é que não existem (existiam?)..."/>
  <meta name="twitter:creator"
        content=""/>
  <meta name="twitter:image:src"
        content="
                     /images/movies.png
                   "/>

  
  <link href="" rel="alternate" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>

  
  <link rel="stylesheet" type="text/css" href="/css/capsule.min.css"/>
  
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>

  
  <script>
  
    
      <!-- Google Analytics -->
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50557403-2', 'auto');
      ga('send', 'pageview');
    
  
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/list.js"></script>

  
  <link rel="icon" href="/favicon.ico"/>
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">
  <div class="container">

    <div class="navbar-brand">
      <a class="navbar-item" title="Go to Home" href="/">
        <img alt="Brand" src="/brand.svg">
        <div class="title is-6">&nbsp;Blogue do Caloni</div>
      </a>

      
      <label class="button navbar-burger is-white" for="navbar-burger-state">
        <span></span>                               
        <span></span>
        <span></span>
      </label>
    </div>

    
    <input type="checkbox" id="navbar-burger-state"/>

    <div class="navbar-menu">
      <div class="navbar-end" style="padding: 10px;">
      <big><b>
       <a title="posts dessa categoria" href="/categories/blog">blog</a>  <a title="posts dessa categoria" href="/categories/cinema">cinema</a>  <a title="posts dessa categoria" href="/categories/code">code</a> 
       <a href="/caloni"><span class="icon"><i class="fa fa-user"></i></a> <a href="index.xml"><span class="icon"><i class="fa fa-rss"></i></a>
      </big></b>
      </div>
    </div>

  </div>
</nav>


      
      <div class="container">
        <p class="title">Convenção de Chamada</p>

        <p class="subtitle">
<i>

    <a href="https://github.com/Caloni/post/commits/master/convencao-de-chamada.md" title="History">
    2015-04-20
    </a>

<span class="icon"><i class="fa fa-clock-o"></span></i>3 </i>
 <span class="icon"><i class="fa fa-pencil"></i></span><a href="https://github.com/Caloni/post/blob/master/convencao-de-chamada.md" title="GitHub">507</a>
</p>

        <div class="taglist">
            <i>Este ainda é um rascunho publicado prematuramente e está sujeito a mudanças substanciais.</i>

        </div>

        

        
          <div class="content">
            
              <p>Pergunta de um leitor:</p>
<pre><code>void func()
{

}

int main()
{
   func(&quot;sbrubles&quot;);
   return 0;
}
</code></pre>
<p>Resposta do Autor: Por que C é zoado :P</p>
<p>OK, a verdade é que não existem (existiam?) muitas regras de sintaxe a serem respeitadas na linguagem pelo compilador. Antigamente, se não fosse colocado nenhum tipo de retorno era como se ele fosse int por default. Da mesma forma, se não colocar parâmetros vale tudo. É como se fossem os três pontinhos do printf. Afinal, você não ia querer ficar repetindo os parâmetros no .c e no .h, não é mesmo :D</p>
<p>Isso me lembra também que havia a declaração &ldquo;arcaica&rdquo; da linguagem (já era arcaica antes mesmo do padrão de 1998 sair):</p>
<pre><code>void func()
char* sbrubles; /* isso é um argumento de entrada */
{
}
</code></pre>
<p>Sim, sua suposição a respeito do vaargs faz todo sentido. E não, os parâmetros não são inutilizados justamente porque a função chamada pode fazer o que quiser que no retorno o chamador limpa a pilha (e o chamador sabe como ele empilhou os parâmetros-extra).</p>
<p>O padrão de chamada da linguagem (lembra disso?) é cdecl. Isso quer dizer que o chamador é que &ldquo;limpa a sujeira&rdquo; depois da chamada. Isso é o que permite o &ldquo;milagre&rdquo; do printf (oooohhh ooohh oooooohhhh&hellip; sons de anjos cantando) receber n argumentos.</p>
<p>Só vai dar problema se definir outro padrão de chamada ou se a função chamada mexer no que não devia (se esperar outros tipos ou número de argumentos, por exemplo).</p>
<p>Agora que sabemos disso, o comportamento do valist nem deve parecer tão mágico assim. Na verdade, apenas saber que a pilha é onde estão todas as variáveis locais e os endereços de retorno das funções é o suficiente para explorar essa área de memória.</p>
<p>Porém, o uso canônico na linguagem C e a forma mais educada de navegar nos parâmetros extras é usando o header stdarg.h. Isso porque C é uma linguagem independente de plataforma, e a priori não temos a mínima ideia de como os dados estão estruturados no computador. Essa visão das variáveis locais e etc é apenas algo que sabemos sobre a arquitetura PC (8086) porque já brincamos demais de assembly e seus registradores.</p>
<pre><code>int soma(int argc, ...);

int main()
{
    int resultado = soma(5, 2, 3, 4, 5, 6);
}

// soma.cpp
#include &lt;stdarg.h&gt;

int soma(int argc, ...)
{
    int ret = 0;

    va_list vl;
    va_start(vl, argc);
    while( --argc )
    {
        int next = va_arg(vl, int);
        ret += next;
    }

    return ret;
}
</code></pre>
<p>Uma versão de quem já manja dos internals da arquitetura onde está programando e não se importa com portabilidade poderia simplesmente caminhar pela pilha a partir do endereço de argc.</p>
<pre><code>int soma(int argc, ...)
{
    int ret = 0;
    int* argv = &amp;argc + 1;

    while ( argc-- )
    {
        int next = *argv++;
        ret += next;
    }

    return ret;
}
</code></pre>
<p>Repetindo: isso não é bonito, apesar de simpático. No entanto, se o objetivo é explorar a arquitetura, fique à vontade para navegar pela pilha a partir do endereço das variáveis locais.</p>

            

          </div>

        <div class="taglist">
            
    
      <a href="/categories/code">code</a> 
      <a href="/tags/draft">draft</a> 
    
    <a href="https://twitter.com/intent/tweet?text=Pergunta%20de%20um%20leitor%3a%0avoid%20func%28%29%0d%7b%0d%7d%0dint%20main%28%29%0d%7b%0dfunc%28%26quot%3bsbrubles%26quot%3b%29%3b%0dreturn%200%3b%0d%7d%0d%20Resposta%20do%20Autor%3a%20Por%20que...%20http%3a%2f%2fwww.caloni.com.br%2fconvencao-de-chamada%2f from @caloni " style="text-decoration: underline;" title="Twitter">twitter</big></a>


        </div>

        <div class="navigation-bottom">
            <span style="float: right;"><a href="http://www.caloni.com.br/whiplash/">Whiplash: Em Busca da Perfeição<span class="icon"><i class="fa fa-arrow-right"></i></span></a></span>
<span style="float: left;"><a href="http://www.caloni.com.br/a-vida-privada-dos-hipopotamos/"><span class="icon"><i class="fa fa-arrow-left"></i></span>A Vida Privada dos Hipopótamos</a></span>

        </div>

      </div>

    <footer class="footer">
  <div class="container">
    <span style="float: right;"><i style="font-size: small;">Blogue do Caloni 2020. Copyright é invenção do capitalismo burguês opressor. Todos os direitos não serão reservados.</i></span>
  </div>
</footer>

  </body>

</html>
