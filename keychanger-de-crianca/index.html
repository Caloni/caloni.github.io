<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">

  
  
      
  
      
  

  <head>
  <meta charset="utf-8" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - Keychanger de criança</title>
  <meta name="author" content="" />

  <meta name="generator" content="Hugo 0.67.1" />

  
  <meta property="og:title" content="Keychanger de criança"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/keychanger-de-crianca/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Às vezes na vida a vontade de fazer alguma coisa besta acaba sendo mais forte do que o senso de ridículo. Então, resolvi ressuscitar o quase apodrecido RusKey, um programa que fiz para trocar letras..."/>

  
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>

  
  
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>

  
  <script>
  
    
      <!-- Google Analytics -->
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-50557403-2', 'auto');
      ga('send', 'pageview');
    
  
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/list.js"></script>

  
  <link rel="icon" href="/img/favicon.ico"/>
  </head>


  <body style="min-height:100vh;display:flex;flex-direction:column">

    <nav class="navbar has-shadow is-white"
     role="navigation" aria-label="main navigation">

  <div class="container">

    <div class="navbar-brand">
        <img alt="Brand" src="/img/brand.svg">
        &nbsp;
        <a class="navbar-item" title="Go to Home" href="/">
            <div class="is-6">Blogue do Caloni</div>
        </a>
    </div>

    

  </div>
</nav>


      
      <div class="container">
        <p class="title">

Keychanger de criança

</p>

        <p class="subtitle">

  Wanderley Caloni,
  
    
  
    
  
  2008-01-24<a href="https://github.com/Caloni/blog/blob/master/content/posts/keychanger-de-crianca.md">.</a>

</p>

        

        
          <div class="content">

            
              <p>Às vezes na vida a vontade de fazer alguma coisa besta acaba sendo mais forte do que o senso de ridículo. Então, resolvi ressuscitar o quase apodrecido <strong>RusKey</strong>, um programa que fiz para trocar letras digitadas no teclado. A idéia é muito simples: o sujeito digita 'i' e sai um 'c', digita um 'f' e sai um 'u', e assim por diante. Se estiver programando e for criar um <strong>if</strong>, por exemplo, no lugar da palavra if vai aparecer... bom, não é exatamente um if que vai aparecer na tela =).</p>
<p>Mas se analisarmos dessa maneira pode parecer até coisa de &quot;ráquer&quot;, o que certamente não é. Na verdade, se trata de um programa didático que visa ensinar a digitação em leiautes de teclados diferentes do normal em idiomas latinos. Pelo menos essa foi a intenção original.</p>
<p>Na época eu estava às voltas com o leiaute do famoso teclado russo (percebeu a origem do nome do programa?). Eu havia estudado <a href="http://en.wikipedia.org/wiki/Cyrillic">cirílico</a> e estava na hora de pôr em prática no computador. Mas, como quase nunca treinava, quando tentava procurar uma palavra no <a href="http://www.babylon.com/">Babylon</a> ou arriscar uma expressão nas conversas com minha amiga de Moscou me perdia completamente para encontrar as letras. A necessidade é a mãe da invenção e foi aí que começou o desenvolvimento.</p>
<p>Um alfabeto é uma das muitas maneiras de representar as palavras de uma língua por escrito. Uma palavra escrita é um conjunto de letras que representa os sons que usamos para falar essa palavra. Cada som usado é chamado de <a href="http://en.wikipedia.org/wiki/Phoneme">fonema</a>.</p>
<p>Assim sendo, embora o alfabeto russo seja diferente do alfabeto latino muitos fonemas são compartilhados. Isso quer dizer que podemos pegar algumas letras do cirílico e traduzir diretamente para algumas letras do nosso alfabeto, e outras letras não. Exemplos de letras que podemos fazer isso:</p>
<pre><code>¿ == B
¿ == V
¿ == G
¿ == D
...
</code></pre>
<p>Porém, após a tradução de uma letra no teclado, a posição dela geralmente não é a mesma posição do nosso teclado. Daí temos uma letra de nosso alfabeto em outro lugar. Se for feita uma tradução aproximada entre os dois alfabetos, nossas letras em um teclado russo ficariam dispostas assim:</p>
<p><a href="/images/russian-keyboard.png"><img src="http://i.imgur.com/0ylTrKm.png" alt="Russian Keyboard"></a></p>
<p>Bem diferente do QWERT ASDFG que estamos acostumados, não?</p>
<p>Ao digitar usando esse pseudo-leiaute o treino do leiaute do teclado russo estaria sendo feito <strong>mesmo escrevendo com o alfabeto latino</strong>. Legal, não? Poderia programar com as letras todas trocadas, porque a saída final é a mesma. Basta treinar os dedos para acertarem as mesmas letras nos novos lugares. Assim, quando precisasse escrever no alfabeto cirílico saberia melhor onde cada letra fica.</p>
<p>A idéia é simples, e o código também não é nada complexo. Só preciso de um EXE e uma DLL. No EXE chamo uma função exportada pela DLL que por sua vez instala um <em>hook</em> de mensagens:</p>
<pre><code>g_hHook = SetWindowsHookEx(WH_GETMESSAGE, HookProc, GetModuleHandle(MODULE_NAME), 0);
</code></pre>
<p>Nas chamadas da função de <em>callback</em> da DLL, manipulo a mensagem <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputmessages/wm_char.asp">WM_CHAR</a>, que corresponde à digitação de caracteres, para trocar os caracteres originais do teclado pelos caracteres que deveriam existir no recém-inventado formato latino-russo, totalmente fora dos padrões e normas de segurança existentes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">switch</span>( pMsg<span style="color:#f92672">-&gt;</span>message )
{
	<span style="color:#66d9ef">case</span> WM_CHAR:
	{
		LPTSTR ptzChar <span style="color:#f92672">=</span>
		_tcschr(g_tzRussAlphabet, (TCHAR) pMsg<span style="color:#f92672">-&gt;</span>wParam);

		<span style="color:#66d9ef">if</span>( ptzChar )
		{
			size_t offset <span style="color:#f92672">=</span> ptzChar <span style="color:#f92672">-</span> g_tzRussAlphabet;
			pMsg<span style="color:#f92672">-&gt;</span>wParam <span style="color:#f92672">=</span> (WPARAM) g_tzPortAlphabet[offset];
		}
	}
} 

</code></pre></div><p>Simples assim. E temos um <em>keylogger</em> que troca caracteres! É impressionante como as coisas mais simples podem se transformar nos momentos mais divertidos de um programador em um feriado.</p>
<ul>
<li><a href="http://www.codeproject.com/KB/winsdk/ruskey.aspx">Endereço do artigo (e fontes) no Code Project</a></li>
</ul>

            

          </div>

        <div class="taglist">
            
    
      <a href="/tags/draft">draft</a>  <a href="/tags/code">code</a> 
    <a class="externalgray" href="https://telegram.me/share/url?url=http://www.caloni.com.br/keychanger-de-crianca/">discuss</a>


        </div>

        <div class="navigation-bottom">
            <span class="next-in-section"><a href="http://www.caloni.com.br/rmthread-rode-codigo-em-processo-vizinho/">&#x25C1; RmThread: rode código em processo vizinho</a></span>
<span class="prev-in-section"><a href="http://www.caloni.com.br/terceiro-encontro-c/">&#x25B7; Terceiro encontro C&#43;&#43;</a></span>

        </div>

      </div>

    <footer class="footer">
  <div class="container">
    <span style="float: right;"><i style="font-size: small;">Blogue do Caloni 2021<a href="https://github.com/Caloni/blog">.</a> </i></span>
  </div>
</footer>

  </body>

</html>
